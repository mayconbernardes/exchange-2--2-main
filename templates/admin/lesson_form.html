{% extends "base.html" %}

{% block title %}{{ title }} - {{ super() }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">{{ title }}</h1>
    <form id="lesson-form" method="POST" action="" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <div class="mb-3">
            {{ form.title.label(class="form-label") }}
            {{ form.title(class="form-control") }}
        </div>
        <div class="mb-3">
            {{ form.text.label(class="form-label") }}
            <!-- Quill Editor Container -->
            <div id="editor-container" style="height: 300px; background: white;">
                {{ form.text.data|safe if form.text.data else '' }}
            </div>
            <!-- Hidden textarea to store Quill HTML for POST -->
            {{ form.text(style="display:none;", id="lesson-text-input") }}
        </div>
        <div class="mb-3">
            {{ form.audio.label(class="form-label") }}
            {{ form.audio(class="form-control") }}
        </div>
        <div class="mb-3">
            {{ form.target_language.label(class="form-label") }}
            {{ form.target_language(class="form-control") }}
        </div>
        <div class="mb-3">
            {{ form.submit(class="btn btn-primary") }}
        </div>
    </form>
</div>

<!-- Quill.js - Simple, Secure, and Free -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
    var quill = new Quill('#editor-container', {
        theme: 'snow',
        placeholder: 'Escreva o conteúdo da lição aqui...',
        modules: {
            toolbar: [
                ['bold', 'italic', 'underline'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['link', 'clean']
            ]
        }
    });

    // On form submit, copy Quill HTML to the actual hidden textarea
    var form = document.getElementById('lesson-form');
    form.onsubmit = function() {
        var textInput = document.getElementById('lesson-text-input');
        textInput.value = quill.root.innerHTML;
    };
</script>
{% endblock %}